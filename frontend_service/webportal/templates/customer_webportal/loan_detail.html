{% extends 'dashboard_layout.html' %}
{% load humanize %}

{% block title %}Loan Details{% endblock %}
{% block page_heading %}My Loans{% endblock %}

{% block extra_css %}
<style>
    /* Unique Gradient for Loan Card (Blue/Purple to distinguish from Accounts) */
    .card-loan-gradient {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 18px 0;
        border-bottom: 1px solid var(--border-light);
        align-items: center;
    }
    .detail-row:last-child { border-bottom: none; }
    
    .detail-label { color: var(--secondary-text); font-size: 0.95rem; }
    .detail-value { font-weight: 600; color: var(--primary-dark); font-size: 1rem; }

    /* Loan Status Badge Colors */
    .badge-status { padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
    .status-active { background: #E7F8F0; color: var(--primary-green); }
    .status-pending { background: #FFF6E6; color: #FFB37B; }
    .status-rejected { background: #FEE2E2; color: #EF4444; }

    /* Apply New Loan CTA Section */
    .apply-section {
        background-color: #F8FAFC;
        border: 2px dashed var(--border-light);
        border-radius: 16px;
        text-align: center;
        padding: 30px;
        transition: all 0.2s;
        cursor: pointer;
    }
    .apply-section:hover {
        border-color: var(--primary-green);
        background-color: #F0FDF4;
    }
    .apply-icon {
        font-size: 2rem;
        color: var(--primary-green);
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-grid">

    <div class="col-span-2">
        <div class="card" style="height: 100%;">
            <div class="flex justify-between items-center mb-4">
                <h3 style="font-size: 1.1rem; font-weight: 600;">Loan Overview</h3>
                <span class="badge-status {% if loan.status == 'Approved' %}status-active{% elif loan.status == 'Pending' %}status-pending{% else %}status-rejected{% endif %}">
                    {{ loan.status|default:"Pending" }}
                </span>
            </div>

            <div class="card-visual card-loan-gradient" style="border-radius: 20px; padding: 25px; height: 220px; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 0 10px 20px rgba(30, 60, 114, 0.3);">
                <div class="flex justify-between items-center">
                    <span style="opacity: 0.8; letter-spacing: 1px;">Personal Loan</span>
                    <i class="fas fa-hand-holding-dollar" style="font-size: 1.5rem; opacity: 0.8;"></i>
                </div>
                
                <div style="margin-top: 10px;">
                    <p style="font-size: 0.8rem; opacity: 0.8; margin-bottom: 5px;">Total Repayable Amount</p>
                    <h2 style="font-size: 2.2rem; font-weight: 600;">₦ {{ loan.repayable|intcomma }}</h2>
                </div>

                <div class="flex justify-between items-center mt-4">
                    <div>
                        <p style="font-size: 0.8rem; opacity: 0.7;">Monthly Pay</p>
                        <p style="font-size: 1.1rem; font-weight: 500;">₦ {{ loan.monthly_repayment|intcomma }}</p>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 0.8rem; opacity: 0.7;">Interest Rate</p>
                        <p style="font-size: 1.1rem; font-weight: 500;">{{ loan.rate }}%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-span-2">
        <div class="card" style="height: 100%;">
            <h3 class="mb-4" style="font-size: 1.1rem; font-weight: 600;">Loan Details</h3>
            
            <div class="detail-row">
                <span class="detail-label">Monthly Repayment</span>
                <span class="detail-value text-green">₦ {{ loan.monthly_repayment|intcomma }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Loan Duration</span>
                <span class="detail-value">{{ loan.duration }} Months</span>
            </div>
            
            <div class="detail-row">
                <span class="detail-label">Interest Rate</span>
                <span class="detail-value">{{ loan.rate }}% Fixed</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Status</span>
                <span class="detail-value">{{ loan.status }}</span>
            </div>

            <div class="detail-row" style="border-bottom: none;">
                <span class="detail-label">Principal Amount</span>
                <span class="detail-value">₦ {{ loan.amount|intcomma }}</span>
            </div>
        </div>
    </div>

    <div class="col-span-4">
        <div class="card">
            <h3 class="mb-4" style="font-size: 1rem; font-weight: 600;">Actions</h3>
            
            <div class="apply-section" onclick="location.href='{% url 'loan_apply' %}'">
                <i class="fas fa-circle-plus apply-icon"></i>
                <h4 style="font-size: 1.1rem; font-weight: 600; color: var(--primary-dark);">Need more funds?</h4>
                <p style="color: var(--secondary-text); margin-top: 5px;">
                    Apply for a new loan instantly. Competitive rates and flexible repayment options.
                </p>
                <button class="btn-primary" style="margin-top: 20px; padding: 10px 30px;">Apply Now</button>
            </div>
        </div>
    </div>

</div>
{% endblock %}