upstream Identity_service {
    server 127.0.0.1:8001;
}
upstream account_service {
    server 127.0.0.1:8002;
}
upstream ledger {
    server 127.0.0.1:8003;
}
upstream payment {
    server 127.0.0.1:8004;
}
upstream webportal {
    server 127.0.0.1:8005;
}

server {
    listen 80;
    server_name localhost 127.0.0.1;

    client_max_body_size 20M;

    # ==========================================
    # 1. SERVE STATIC FILES (Crucial for Frontend)
    # ==========================================
    # You must run 'python manage.py collectstatic' in your webportal first
    # and point 'alias' to that folder.
    
    location /static/ {
        alias C:\Users\samsung\Desktop\VS\Arhan_Financial_Platform\frontend_service\webportal\static; 
    }

    location /media/ {
        alias C:\Users\samsung\Desktop\VS\Arhan_Financial_Platform\frontend_service\media\;
    }

    # ==========================================
    # 2. MAIN FRONTEND APP (At the Root)
    # ==========================================
    # This captures all traffic (home, login, dashboard) and sends it 
    # to your Webportal Django app.
    
    location / {
        proxy_pass http://webportal;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ==========================================
    # 3. MICROSERVICES (The APIs)
    # ==========================================
    # We keep these so your frontend can talk to them if needed,
    # or for external API access.

    location /api/Identity_service/ {
        proxy_pass http://Identity_service/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/account_service/ {
        proxy_pass http://account_service/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ledger/ {
        proxy_pass http://ledger/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/payment/ {
        proxy_pass http://payment/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}